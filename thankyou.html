<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Appointment Confirmed – RS Home Care</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
body{
  font-family:'Poppins',sans-serif;
  background:#f5f9ff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.box{
  background:#fff;
  padding:40px;
  border-radius:20px;
  max-width:420px;
  width:100%;
  text-align:center;
  box-shadow:0 15px 40px rgba(0,0,0,.15);
}
img{max-width:120px;margin-bottom:15px}
button{
  margin-top:20px;
  padding:14px 28px;
  border:none;
  border-radius:30px;
  background:#2ecc71;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="box">
  <img src="logo.png" alt="RS Home Care">
  <h2>Appointment Submitted</h2>
  <p id="clientInfo"></p>

  <button id="downloadBtn">Download Confirmation Letter</button>
</div>

<script>
// Generate unique reference number
function generateReferenceNumber() {
  const now = new Date();
  const datePart = now.toISOString().slice(0,10).replace(/-/g,""); // YYYYMMDD
  const randomPart = Math.random().toString(36).substring(2,7).toUpperCase(); // 5-char random
  return `RS-${datePart}-${randomPart}`;
}

// Generate random appointment number
function generateAppointmentNumber() {
  return `RSHC-${Math.floor(1000 + Math.random() * 9000)}`; // 1000–9999
}

// Appointment status
const appointmentStatus = "Confirmed";

const referenceNumber = generateReferenceNumber();
const appointmentNumber = generateAppointmentNumber();

// Save to sessionStorage for PDF
sessionStorage.setItem("rs_ref", referenceNumber);
sessionStorage.setItem("rs_apt", appointmentNumber);
sessionStorage.setItem("rs_status", appointmentStatus);

document.addEventListener("DOMContentLoaded", () => {

  const name  = sessionStorage.getItem("rs_name");
  const phone = sessionStorage.getItem("rs_phone");

  if(!name || !phone){
    alert("Client details missing. Please book appointment again.");
    window.location.href = "index.html"; // redirect to booking page
    return;
  }

  // Show info on page
  document.getElementById("clientInfo").innerHTML =
    `<strong>Name:</strong> ${name}<br>
     <strong>Phone:</strong> ${phone}<br>
     <strong>Reference No:</strong> ${referenceNumber}<br>
     <strong>Appointment No:</strong> ${appointmentNumber}<br>
     <strong>Status:</strong> ${appointmentStatus}`;

  document.getElementById("downloadBtn").addEventListener("click", generatePDF);

  function generatePDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const date = new Date().toLocaleDateString("en-GB", {
      day:"2-digit",
      month:"long",
      year:"numeric"
    });

    // HEADER
    doc.setFont("helvetica","bold");
    doc.setFontSize(18);
    doc.text("RS HOME CARE",105,18,{align:"center"});

    doc.setFontSize(12);
    doc.setFont("helvetica","normal");
    doc.text("Appointment Confirmation Letter",105,28,{align:"center"});
    doc.line(20,32,190,32);

    // APPOINTMENT NUMBER BOX
    doc.setFillColor(230, 240, 255); // light blue background
    doc.rect(20,40,170,15,"F");
    doc.setFont("helvetica","bold");
    doc.setFontSize(12);
    doc.text(`Appointment No: ${appointmentNumber}`,105,50,{align:"center"});

    // STATUS BOX (separate)
    doc.setFillColor(180, 230, 180); // light green
    doc.rect(20,60,170,15,"F");
    doc.setFont("helvetica","bold");
    doc.setFontSize(12);
    doc.text(`Status: ${appointmentStatus}`,105,70,{align:"center"});

    // CLIENT DETAILS
    doc.setFont("helvetica","bold");
    doc.setFontSize(12);
    doc.text("Client Details",20,85);

    doc.setFont("helvetica","normal");
    doc.setFontSize(11);
    doc.text(`Name        : ${name}`,20,93);
    doc.text(`Phone       : ${phone}`,20,101);
    doc.text(`Reference No: ${referenceNumber}`,20,109);
    doc.text(`Date        : ${date}`,20,117);

    // MESSAGE
    const messageStartY = 130;
    const message = "Thank you for booking an appointment with RS Home Care.\n\n" +
                    "Your request has been successfully received.\n" +
                    "Our team will contact you shortly to confirm the appointment.\n\n" +
                    "We are committed to providing compassionate and professional care.";
    const splitMessage = doc.splitTextToSize(message, 170);
    doc.text(splitMessage, 20, messageStartY);

    // SIGNATURE
    doc.text("For RS Home Care,",20,160);
    doc.text("Management",20,168);

    const img = new Image();
    img.src = "signature.png";

    img.onload = () => {
      doc.addImage(img,"PNG",20,170,60,25);

      doc.setFontSize(10);
      doc.text("RS Home Care Pvt Ltd",105,190,{align:"center"});
      doc.text(
        "Phone: +91 7550052799 | Email: rshomecaremaduraiofficial@gmail.com",
        105,197,{align:"center"}
      );

      // Save PDF with safe filename
      const safeName = name.replace(/\s+/g, '_').replace(/[^a-zA-Z0-9_]/g, '');
      doc.save(`RS_Home_Care_Appointment_${safeName}.pdf`);
    };

    // Fallback if signature fails
    img.onerror = () => {
      const safeName = name.replace(/\s+/g, '_').replace(/[^a-zA-Z0-9_]/g, '');
      doc.save(`RS_Home_Care_Appointment_${safeName}.pdf`);
    };
  }
});
</script>

</body>
</html>

